

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial Introduction &mdash; liblightnvm 0.0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="liblightnvm 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="C API" href="c.html"/>
        <link rel="prev" title="Background" href="background.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> liblightnvm
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#obtaining-device-information">Obtaining device information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#physical-addressing">Physical Addressing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generic-format">Generic format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#device-format">Device format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#address-scope">Address scope</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#vectorized-io-to-nand-media">Vectorized IO to NAND media</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#erase-before-write">Erase before write</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write">Write</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#minimum-write">Minimum write</a></li>
<li class="toctree-l4"><a class="reference internal" href="#maximum-write">Maximum write</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#read">Read</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#minimal-read">Minimal Read</a></li>
<li class="toctree-l4"><a class="reference internal" href="#maximum-read">Maximum Read</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-contiguous-read">Non-Contiguous Read</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#virtual-block">Virtual Block</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-physical-block-sets">Using physical block sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-physical-block-line">Using physical block line</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bad-block-table">Bad-Block-Table</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="c.html">C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli/index.html">Command-Line Interface</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">liblightnvm</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Tutorial Introduction</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial-introduction">
<h1>Tutorial Introduction<a class="headerlink" href="#tutorial-introduction" title="Permalink to this headline">¶</a></h1>
<p>This introduction will go through how to retrieve device information, construct
physical addresses, issue vectorized IO, retrieve and mange media state, and
introduce the virtual block abstraction.</p>
<p>It will be using the command-line interface (CLI), and provide notes for the
corresponding parts of the C API. It is assumed throughout that an Open-Channel
SSD available at the path <code class="docutils literal"><span class="pre">/dev/nvme0n1</span></code> and that liblightnvm is installed on
the system.</p>
<p>To begin with, knowing the physical geometry of a device is essential for
working with physical addressing.</p>
<div class="section" id="obtaining-device-information">
<h2>Obtaining device information<a class="headerlink" href="#obtaining-device-information" title="Permalink to this headline">¶</a></h2>
<p>Device information is obtained by invoking:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_dev</span> <span class="n">info</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span>
</pre></div>
</div>
<p>Which will yield device information as shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dev</span> <span class="p">{</span>
 <span class="n">verid</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span> <span class="n">beid</span><span class="p">(</span><span class="mh">0x01</span><span class="p">),</span>
 <span class="n">path</span><span class="p">(</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span><span class="p">),</span> <span class="n">name</span><span class="p">(</span><span class="n">nvme0n1</span><span class="p">),</span> <span class="n">fd</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
 <span class="n">ssw</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="n">pmode</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
 <span class="n">erase_naddrs_max</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span> <span class="n">read_naddrs_max</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span> <span class="n">write_naddrs_max</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
 <span class="n">meta_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
 <span class="n">bbts_cached</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">},</span>
<span class="n">dev</span><span class="o">-</span><span class="n">geo</span> <span class="p">{</span>
 <span class="n">nchannels</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span> <span class="n">nluns</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">nplanes</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
 <span class="n">nblocks</span><span class="p">(</span><span class="mi">1020</span><span class="p">),</span> <span class="n">npages</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">nsectors</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
 <span class="n">page_nbytes</span><span class="p">(</span><span class="mi">16384</span><span class="p">),</span> <span class="n">sector_nbytes</span><span class="p">(</span><span class="mi">4096</span><span class="p">),</span> <span class="n">meta_nbytes</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
 <span class="n">tbytes</span><span class="p">(</span><span class="mi">2190433320960</span><span class="n">b</span><span class="p">:</span><span class="mi">2088960</span><span class="n">Mb</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">dev</span><span class="o">-</span><span class="n">ppaf</span> <span class="p">{</span>
  <span class="n">ch_off</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>  <span class="n">ch_len</span><span class="p">(</span><span class="mi">04</span><span class="p">),</span>
 <span class="n">lun_off</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span> <span class="n">lun_len</span><span class="p">(</span><span class="mi">03</span><span class="p">),</span>
  <span class="n">pl_off</span><span class="p">(</span><span class="mi">02</span><span class="p">),</span>  <span class="n">pl_len</span><span class="p">(</span><span class="mi">01</span><span class="p">),</span>
 <span class="n">blk_off</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="n">blk_len</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
  <span class="n">pg_off</span><span class="p">(</span><span class="mi">03</span><span class="p">),</span>  <span class="n">pg_len</span><span class="p">(</span><span class="mi">09</span><span class="p">),</span>
 <span class="n">sec_off</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">sec_len</span><span class="p">(</span><span class="mi">02</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">dev</span><span class="o">-</span><span class="n">ppaf_mask</span> <span class="p">{</span>
  <span class="n">ch</span><span class="p">(</span><span class="mi">0000000000000000000000000000000000011110000000000000000000000000</span><span class="p">),</span>
 <span class="n">lun</span><span class="p">(</span><span class="mi">0000000000000000000000000000000000000001110000000000000000000000</span><span class="p">),</span>
  <span class="n">pl</span><span class="p">(</span><span class="mi">0000000000000000000000000000000000000000000000000000000000000100</span><span class="p">),</span>
 <span class="n">blk</span><span class="p">(</span><span class="mi">0000000000000000000000000000000000000000001111111111000000000000</span><span class="p">),</span>
  <span class="n">pg</span><span class="p">(</span><span class="mi">0000000000000000000000000000000000000000000000000000111111111000</span><span class="p">),</span>
 <span class="n">sec</span><span class="p">(</span><span class="mi">0000000000000000000000000000000000000000000000000000000000000011</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The parts involved from the C API are: <code class="docutils literal"><span class="pre">nvm_dev_open</span></code> to obtain a device
handle, <code class="docutils literal"><span class="pre">nvm_dev_pr</span></code> to produce the output above, and lastly
<code class="docutils literal"><span class="pre">nvm_dev_close</span></code> to terminate the handle properly.</p>
<p>When using the C API, values and structures are retrieved using the attribute
getters <code class="docutils literal"><span class="pre">nvm_dev_get_*</span></code> e.g. use <code class="docutils literal"><span class="pre">nvm_dev_get_geo</span></code> to obtain the geometry
of a given device.</p>
</div>
<div class="section" id="physical-addressing">
<h2>Physical Addressing<a class="headerlink" href="#physical-addressing" title="Permalink to this headline">¶</a></h2>
<p>Most of the library takes one or more physical addresses as parameter.</p>
<div class="section" id="generic-format">
<h3>Generic format<a class="headerlink" href="#generic-format" title="Permalink to this headline">¶</a></h3>
<p>The physical addresses are represented in generic format by the data-structure
<code class="docutils literal"><span class="pre">struct</span> <span class="pre">nvm_addr</span></code>. One can construct an address by specifying the relative
location within the device geometry down to the granularity of a sector.</p>
<p>Example: Construct an address for sector 3 within page 11 in block 200 on
plane 0 of LUN 1 in channel 4:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr</span> <span class="n">from_geo</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">200</span> <span class="mi">10</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mh">0x04010003000a00c8</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">04</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">01</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0200</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">010</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>The above hexidecimal-value can be given to any CLI command taking an <code class="docutils literal"><span class="pre">addr</span></code>
as parameter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Addresses are zero-indexed, so channel 4 is the fifth channel</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">C API address construction is done by assigning the members of <code class="docutils literal"><span class="pre">struct</span> <span class="pre">nvm_addr</span></code></p>
</div>
</div>
<div class="section" id="device-format">
<h3>Device format<a class="headerlink" href="#device-format" title="Permalink to this headline">¶</a></h3>
<p>As the output from the device information shows, then there is a notion of a
device format. The library user need not be concerned with the device format as
the translation to device format is handled by the library for every part of
the interface with the exception of the low-level command-interface
<code class="docutils literal"><span class="pre">nvm_cmd</span></code>.</p>
<p>However, if one needs an address on device format for <code class="docutils literal"><span class="pre">nvm_cmd</span></code> or another
tool such as <code class="docutils literal"><span class="pre">nvme-cli</span></code>, then the generic-format can be converted to
device format using:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr</span> <span class="n">gen2dev</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> <span class="mh">0x04010003000a00c8</span>
</pre></div>
</div>
<p>Yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gen</span><span class="o">-</span><span class="n">addr</span><span class="p">(</span><span class="mh">0x04010003000a00c8</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">04</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">01</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0200</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">010</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="n">dev</span><span class="o">-</span><span class="n">addr</span><span class="p">(</span><span class="mh">0x00000000084c8053</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">C API address format conversion is done using <code class="docutils literal"><span class="pre">nvm_addr_gen2dev</span></code></p>
</div>
</div>
<div class="section" id="address-scope">
<h3>Address scope<a class="headerlink" href="#address-scope" title="Permalink to this headline">¶</a></h3>
<p>An address specifies the relative location of all parts of the geometry,
channel, lun, plane, block, page and sector. However, not all parts of the
library uses all location information. Most common uses are:</p>
<dl class="docutils">
<dt>LUN address</dt>
<dd>Specify channel and LUN within the channel</dd>
<dt>Block address</dt>
<dd>Specify channel, LUN within the channel, plane within the LUN, and block
within the plane</dd>
<dt>Sector address</dt>
<dd>Specify all relative locations of the geometry</dd>
</dl>
</div>
</div>
<div class="section" id="vectorized-io-to-nand-media">
<h2>Vectorized IO to NAND media<a class="headerlink" href="#vectorized-io-to-nand-media" title="Permalink to this headline">¶</a></h2>
<p>With the basics of obtaining device information and constructing addresses in
place one can dive into the task of constructing commands for doing vectorized
IO.</p>
<p>As the section on background information describes, then there are handful of
constraints to handle for IOs to NAND media to succeed.</p>
<div class="section" id="erase-before-write">
<h3>Erase before write<a class="headerlink" href="#erase-before-write" title="Permalink to this headline">¶</a></h3>
<p>The first constraint to handle is that a block must be <strong>erased</strong> before it can be
<strong>written</strong>. We do so by constructing block-addresses for all blocks within a plane:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr</span> <span class="n">from_geo</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">10</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">nvm_addr</span> <span class="n">from_geo</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">10</span> <span class="mi">0</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mh">0x000000000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>With the addresses we can now construct a single command with two addresses and
send of the erase:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr</span> <span class="n">erase</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> <span class="mh">0x000000000000000a</span> <span class="mh">0x000001000000000a</span>
</pre></div>
</div>
<p>On success, yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_addr_erase</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">:</span> <span class="n">pmode</span><span class="p">(</span><span class="mh">0x1</span><span class="p">)</span>
<span class="p">(</span><span class="mh">0x000000000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>On error, yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_addr_erase</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">:</span> <span class="n">pmode</span><span class="p">(</span><span class="mh">0x1</span><span class="p">)</span>
<span class="p">(</span><span class="mh">0x000000000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="n">nvm_addr_erase</span><span class="p">:</span> <span class="n">Input</span><span class="o">/</span><span class="n">output</span> <span class="n">error</span>
<span class="n">nvm_ret</span> <span class="p">{</span> <span class="n">result</span><span class="p">(</span><span class="mh">0xff</span><span class="p">),</span> <span class="n">status</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>If an erase fails as above then it is because a block is bad. The
bad-block-table interface (nvm_bbt) is provided to communicate and update media
state. Introduction to the bad-block-table is given in a later section.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">C API for performing erases using block-adressing is done with <code class="docutils literal"><span class="pre">nvm_addr_erase</span></code></p>
</div>
</div>
<div class="section" id="write">
<h3>Write<a class="headerlink" href="#write" title="Permalink to this headline">¶</a></h3>
<p>The two primary constraints for issuing writes are that they must be at the
granularity of a full flash page and contiguous within a block.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">C API for performing write using vectorized IO with addressing at
sector-level is done using <code class="docutils literal"><span class="pre">nvm_addr_write</span></code>, note that the payload must
be aligned to sector size, the helper function <code class="docutils literal"><span class="pre">nvm_buf_alloc</span></code> is
provided for convenience</p>
</div>
<div class="section" id="minimum-write">
<h4>Minimum write<a class="headerlink" href="#minimum-write" title="Permalink to this headline">¶</a></h4>
<p>For the geometry in figure X, a full flash page is four sectors of each 4096
bytes, a command satisfying the minimum-write constraint thus contains four
addresses with a payload of 16384 bytes of data. The command can constructed
via the CLI as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr</span> <span class="n">write</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> \
<span class="mh">0x000000000000000a</span> <span class="mh">0x000000010000000a</span> <span class="mh">0x000000020000000a</span> <span class="mh">0x000000030000000a</span>
</pre></div>
</div>
<p>The CLI creates an arbitrary payload, so we do not concern us with the
payload at this point.</p>
<p>The result of the command is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr_write</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">:</span> <span class="n">pmode</span><span class="p">(</span><span class="mh">0x1</span><span class="p">)</span>
<span class="p">(</span><span class="mh">0x000000000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000010000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000020000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000030000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="n">nvm_addr_write</span><span class="p">:</span> <span class="n">Input</span><span class="o">/</span><span class="n">output</span> <span class="n">error</span>
<span class="n">nvm_ret</span> <span class="p">{</span> <span class="n">result</span><span class="p">(</span><span class="mh">0x2</span><span class="p">),</span> <span class="n">status</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>An unexpected write error occured, the constraints are satisfied, so what goes
wrong? The issue in this case is that the command is constructed using
plane-mode (specifically <code class="docutils literal"><span class="pre">pmode(0x1)</span></code>).</p>
<p>This introduces an additional constraint that writes must be performed to
the block accross all planes. One can choose to disable the plane-mode, which is
done by setting environment var <code class="docutils literal"><span class="pre">NVM_CLI_PMODE=&quot;0&quot;</span></code> or by constructing a
command satisfying the plane-mode constraint:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr</span> <span class="n">write</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> \
<span class="mh">0x000000000000000a</span> <span class="mh">0x000000010000000a</span> <span class="mh">0x000000020000000a</span> <span class="mh">0x000000030000000a</span>
<span class="mh">0x000001000000000a</span> <span class="mh">0x000001010000000a</span> <span class="mh">0x000001020000000a</span> <span class="mh">0x000001030000000a</span>
</pre></div>
</div>
<p>Yielding without error:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_addr_write</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">:</span> <span class="n">pmode</span><span class="p">(</span><span class="mh">0x1</span><span class="p">)</span>
<span class="p">(</span><span class="mh">0x000000000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000010000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000020000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000030000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001010000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001020000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001030000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>The plane-mode allows for multiple writes to be done in parallel across the
planes.</p>
</div>
<div class="section" id="maximum-write">
<h4>Maximum write<a class="headerlink" href="#maximum-write" title="Permalink to this headline">¶</a></h4>
<p>An improvement of round-trip-time can be obtained by increasing the amount of
work done by a single command, that is, increase the number of addresses.</p>
<p>There is an upper limit, write-naddrs-max,  as can be seen in figure X, and
retrieved from the device. In our case we can construct a command with 64
addresses.</p>
<p>Abiding to all of the above mentioned constraints a write command can be
constructed as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr</span> <span class="n">write</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> \
<span class="mh">0x000000000001000a</span> <span class="mh">0x000000010001000a</span> <span class="mh">0x000000020001000a</span> <span class="mh">0x000000030001000a</span> \
<span class="mh">0x000001000001000a</span> <span class="mh">0x000001010001000a</span> <span class="mh">0x000001020001000a</span> <span class="mh">0x000001030001000a</span> \
<span class="mh">0x000000000002000a</span> <span class="mh">0x000000010002000a</span> <span class="mh">0x000000020002000a</span> <span class="mh">0x000000030002000a</span> \
<span class="mh">0x000001000002000a</span> <span class="mh">0x000001010002000a</span> <span class="mh">0x000001020002000a</span> <span class="mh">0x000001030002000a</span> \
<span class="mh">0x000000000003000a</span> <span class="mh">0x000000010003000a</span> <span class="mh">0x000000020003000a</span> <span class="mh">0x000000030003000a</span> \
<span class="mh">0x000001000003000a</span> <span class="mh">0x000001010003000a</span> <span class="mh">0x000001020003000a</span> <span class="mh">0x000001030003000a</span> \
<span class="mh">0x000000000004000a</span> <span class="mh">0x000000010004000a</span> <span class="mh">0x000000020004000a</span> <span class="mh">0x000000030004000a</span> \
<span class="mh">0x000001000004000a</span> <span class="mh">0x000001010004000a</span> <span class="mh">0x000001020004000a</span> <span class="mh">0x000001030004000a</span> \
<span class="mh">0x000000000005000a</span> <span class="mh">0x000000010005000a</span> <span class="mh">0x000000020005000a</span> <span class="mh">0x000000030005000a</span> \
<span class="mh">0x000001000005000a</span> <span class="mh">0x000001010005000a</span> <span class="mh">0x000001020005000a</span> <span class="mh">0x000001030005000a</span> \
<span class="mh">0x000000000006000a</span> <span class="mh">0x000000010006000a</span> <span class="mh">0x000000020006000a</span> <span class="mh">0x000000030006000a</span> \
<span class="mh">0x000001000006000a</span> <span class="mh">0x000001010006000a</span> <span class="mh">0x000001020006000a</span> <span class="mh">0x000001030006000a</span> \
<span class="mh">0x000000000007000a</span> <span class="mh">0x000000010007000a</span> <span class="mh">0x000000020007000a</span> <span class="mh">0x000000030007000a</span> \
<span class="mh">0x000001000007000a</span> <span class="mh">0x000001010007000a</span> <span class="mh">0x000001020007000a</span> <span class="mh">0x000001030007000a</span> \
<span class="mh">0x000000000008000a</span> <span class="mh">0x000000010008000a</span> <span class="mh">0x000000020008000a</span> <span class="mh">0x000000030008000a</span> \
<span class="mh">0x000001000008000a</span> <span class="mh">0x000001010008000a</span> <span class="mh">0x000001020008000a</span> <span class="mh">0x000001030008000a</span>
</pre></div>
</div>
<p>Successfully yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_addr_write</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">:</span> <span class="n">pmode</span><span class="p">(</span><span class="mh">0x1</span><span class="p">)</span>
<span class="p">(</span><span class="mh">0x000000000001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000010001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000020001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000030001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001010001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001020001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001030001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000000002000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">002</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000010002000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">002</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000020002000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">002</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000030002000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">002</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000002000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">002</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001010002000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">002</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001020002000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">002</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001030002000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">002</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
           <span class="o">...</span> <span class="n">output</span> <span class="k">for</span> <span class="n">pages</span> <span class="mi">3</span><span class="o">-</span><span class="mi">7</span> <span class="n">omitted</span> <span class="k">for</span> <span class="n">brevity</span> <span class="o">...</span>
<span class="p">(</span><span class="mh">0x000000000008000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">008</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000010008000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">008</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000020008000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">008</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000030008000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">008</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000008000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">008</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001010008000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">008</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001020008000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">008</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001030008000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">008</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>Using vectorized IO we have with a single command successfully written a
payload of 64 x 4096 bytes = 256 KB.</p>
</div>
</div>
<div class="section" id="read">
<h3>Read<a class="headerlink" href="#read" title="Permalink to this headline">¶</a></h3>
<p>Reads have fewer constraints than writes. The granularity of a read is a single
sector (the smallest addressable unit) and can be performed non-contiguously.</p>
<p>The primary constraint for a read to adhere to is that the block which is read
from must be closed. That is, all pages within the block must have been
written. It might be that the constraint can be relaxed where only N pages
ahead of the read must have been written instead of all pages in the block. The
challenge with relaxing the constraint is that N is often an unknown size.</p>
<p>We have so far written a total of nine pages (across two planes), the first
page in one command, the remaining eight pages in a second command. Thus we
have 503 pages that need to be written before we can start reading.</p>
<p>Specifying the 503 x nplanes x nsectors = 4024 addresses via the CLI is
tedious, we will therefore take a sneak peak at virtual blocks and execute:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_vblk</span> <span class="n">line_erase</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">10</span>
<span class="n">nvm_vblk</span> <span class="n">line_write</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">10</span>
</pre></div>
</div>
<p>What these two commands actually do will be described in the following section
on virtual blocks. For now all we need to know is that the block is now fully
written / closed and we can start reading from it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">C API for performing write using vectorized IO with addressing at
sector-level is done using <code class="docutils literal"><span class="pre">nvm_addr_read</span></code>, the received payload must be
stored in a sector-aligned buffer, the helper function <code class="docutils literal"><span class="pre">nvm_buf_alloc</span></code> is
provided for convenience</p>
</div>
<div class="section" id="minimal-read">
<h4>Minimal Read<a class="headerlink" href="#minimal-read" title="Permalink to this headline">¶</a></h4>
<p>We can read a single sector:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr</span> <span class="n">read</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> <span class="mh">0x000000000000000a</span>
</pre></div>
</div>
<p>Yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_addr_read</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">:</span> <span class="n">pmode</span><span class="p">(</span><span class="mh">0x1</span><span class="p">)</span>
<span class="p">(</span><span class="mh">0x000000000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>Setting the environment var <code class="docutils literal"><span class="pre">NVM_CLI_BUF_PR</span></code>, will dump the read payload to
stdout, yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_addr_read</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">:</span> <span class="n">pmode</span><span class="p">(</span><span class="mh">0x1</span><span class="p">)</span>
<span class="p">(</span><span class="mh">0x000000000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="o">**</span> <span class="n">Read</span> <span class="n">buffer</span><span class="p">:</span>
<span class="o">**</span> <span class="n">NVM_BUF_PR</span> <span class="o">-</span> <span class="n">BEGIN</span> <span class="o">**</span>
<span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">31</span><span class="p">]:</span>  <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span> <span class="n">G</span> <span class="n">H</span> <span class="n">I</span> <span class="n">J</span> <span class="n">K</span> <span class="n">L</span> <span class="n">M</span> <span class="n">N</span> <span class="n">O</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span> <span class="n">S</span> <span class="n">T</span> <span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span>
<span class="n">i</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span><span class="mi">63</span><span class="p">]:</span>  <span class="n">G</span> <span class="n">H</span> <span class="n">I</span> <span class="n">J</span> <span class="n">K</span> <span class="n">L</span> <span class="n">M</span> <span class="n">N</span> <span class="n">O</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span> <span class="n">S</span> <span class="n">T</span> <span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span> <span class="n">G</span> <span class="n">H</span> <span class="n">I</span> <span class="n">J</span> <span class="n">K</span> <span class="n">L</span>
<span class="n">i</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span><span class="mi">95</span><span class="p">]:</span>  <span class="n">M</span> <span class="n">N</span> <span class="n">O</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span> <span class="n">S</span> <span class="n">T</span> <span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span> <span class="n">G</span> <span class="n">H</span> <span class="n">I</span> <span class="n">J</span> <span class="n">K</span> <span class="n">L</span> <span class="n">M</span> <span class="n">N</span> <span class="n">O</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span>
<span class="n">i</span><span class="p">[</span><span class="mi">96</span><span class="p">,</span><span class="mi">127</span><span class="p">]:</span>  <span class="n">S</span> <span class="n">T</span> <span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span> <span class="n">G</span> <span class="n">H</span> <span class="n">I</span> <span class="n">J</span> <span class="n">K</span> <span class="n">L</span> <span class="n">M</span> <span class="n">N</span> <span class="n">O</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span> <span class="n">S</span> <span class="n">T</span> <span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">X</span>
             <span class="o">...</span> <span class="n">output</span> <span class="k">for</span> <span class="nb">bytes</span> <span class="mi">128</span> <span class="o">-</span> <span class="mi">4063</span> <span class="n">omitted</span> <span class="k">for</span> <span class="n">brevity</span> <span class="o">...</span>
<span class="n">i</span><span class="p">[</span><span class="mi">4064</span><span class="p">,</span><span class="mi">4095</span><span class="p">]:</span>  <span class="n">I</span> <span class="n">J</span> <span class="n">K</span> <span class="n">L</span> <span class="n">M</span> <span class="n">N</span> <span class="n">O</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span> <span class="n">S</span> <span class="n">T</span> <span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span> <span class="n">G</span> <span class="n">H</span> <span class="n">I</span> <span class="n">J</span> <span class="n">K</span> <span class="n">L</span> <span class="n">M</span> <span class="n">N</span>
<span class="o">**</span> <span class="n">NVM_BUF_PR</span> <span class="o">-</span> <span class="n">END</span> <span class="o">**</span>
</pre></div>
</div>
</div>
<div class="section" id="maximum-read">
<h4>Maximum Read<a class="headerlink" href="#maximum-read" title="Permalink to this headline">¶</a></h4>
<p>Same as a write, a read has an upper bound on the number of addresses in a
single command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr</span> <span class="n">read</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> \
<span class="mh">0x000000000000000a</span> <span class="mh">0x000000010000000a</span> <span class="mh">0x000000020000000a</span> <span class="mh">0x000000030000000a</span> \
<span class="mh">0x000001000000000a</span> <span class="mh">0x000001010000000a</span> <span class="mh">0x000001020000000a</span> <span class="mh">0x000001030000000a</span> \
<span class="mh">0x000000000001000a</span> <span class="mh">0x000000010001000a</span> <span class="mh">0x000000020001000a</span> <span class="mh">0x000000030001000a</span> \
<span class="mh">0x000001000001000a</span> <span class="mh">0x000001010001000a</span> <span class="mh">0x000001020001000a</span> <span class="mh">0x000001030001000a</span> \
<span class="mh">0x000000000002000a</span> <span class="mh">0x000000010002000a</span> <span class="mh">0x000000020002000a</span> <span class="mh">0x000000030002000a</span> \
<span class="mh">0x000001000002000a</span> <span class="mh">0x000001010002000a</span> <span class="mh">0x000001020002000a</span> <span class="mh">0x000001030002000a</span> \
<span class="mh">0x000000000003000a</span> <span class="mh">0x000000010003000a</span> <span class="mh">0x000000020003000a</span> <span class="mh">0x000000030003000a</span> \
<span class="mh">0x000001000003000a</span> <span class="mh">0x000001010003000a</span> <span class="mh">0x000001020003000a</span> <span class="mh">0x000001030003000a</span> \
<span class="mh">0x000000000004000a</span> <span class="mh">0x000000010004000a</span> <span class="mh">0x000000020004000a</span> <span class="mh">0x000000030004000a</span> \
<span class="mh">0x000001000004000a</span> <span class="mh">0x000001010004000a</span> <span class="mh">0x000001020004000a</span> <span class="mh">0x000001030004000a</span> \
<span class="mh">0x000000000005000a</span> <span class="mh">0x000000010005000a</span> <span class="mh">0x000000020005000a</span> <span class="mh">0x000000030005000a</span> \
<span class="mh">0x000001000005000a</span> <span class="mh">0x000001010005000a</span> <span class="mh">0x000001020005000a</span> <span class="mh">0x000001030005000a</span> \
<span class="mh">0x000000000006000a</span> <span class="mh">0x000000010006000a</span> <span class="mh">0x000000020006000a</span> <span class="mh">0x000000030006000a</span> \
<span class="mh">0x000001000006000a</span> <span class="mh">0x000001010006000a</span> <span class="mh">0x000001020006000a</span> <span class="mh">0x000001030006000a</span> \
<span class="mh">0x000000000007000a</span> <span class="mh">0x000000010007000a</span> <span class="mh">0x000000020007000a</span> <span class="mh">0x000000030007000a</span> \
<span class="mh">0x000001000007000a</span> <span class="mh">0x000001010007000a</span> <span class="mh">0x000001020007000a</span> <span class="mh">0x000001030007000a</span>
</pre></div>
</div>
<p>Yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_addr_read</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">:</span> <span class="n">pmode</span><span class="p">(</span><span class="mh">0x1</span><span class="p">)</span>
<span class="p">(</span><span class="mh">0x000000000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000010000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000020000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000030000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001010000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001020000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001030000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000000001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000010001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000020001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000030001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001010001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001020001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001030001000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">001</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
             <span class="o">...</span> <span class="n">output</span> <span class="k">for</span> <span class="n">pages</span> <span class="mi">3</span><span class="o">-</span><span class="mi">7</span> <span class="n">omitted</span> <span class="k">for</span> <span class="n">brevity</span> <span class="o">...</span>
<span class="p">(</span><span class="mh">0x000000000007000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">007</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000010007000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">007</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000020007000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">007</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000030007000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">007</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000007000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">007</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001010007000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">007</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001020007000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">007</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001030007000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">007</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="non-contiguous-read">
<h4>Non-Contiguous Read<a class="headerlink" href="#non-contiguous-read" title="Permalink to this headline">¶</a></h4>
<p>Reading pages 500, 200, 0, and 6 across planes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_addr</span> <span class="n">read</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> \
<span class="mh">0x0000000001f4000a</span> <span class="mh">0x0000000101f4000a</span> <span class="mh">0x0000000201f4000a</span> <span class="mh">0x0000000301f4000a</span> \
<span class="mh">0x0000010001f4000a</span> <span class="mh">0x0000010101f4000a</span> <span class="mh">0x0000010201f4000a</span> <span class="mh">0x0000010301f4000a</span> \
<span class="mh">0x0000000000c8000a</span> <span class="mh">0x0000000100c8000a</span> <span class="mh">0x0000000200c8000a</span> <span class="mh">0x0000000300c8000a</span> \
<span class="mh">0x0000010000c8000a</span> <span class="mh">0x0000010100c8000a</span> <span class="mh">0x0000010200c8000a</span> <span class="mh">0x0000010300c8000a</span> \
<span class="mh">0x000000000000000a</span> <span class="mh">0x000000010000000a</span> <span class="mh">0x000000020000000a</span> <span class="mh">0x000000030000000a</span> \
<span class="mh">0x000001000000000a</span> <span class="mh">0x000001010000000a</span> <span class="mh">0x000001020000000a</span> <span class="mh">0x000001030000000a</span> \
<span class="mh">0x000000000006000a</span> <span class="mh">0x000000010006000a</span> <span class="mh">0x000000020006000a</span> <span class="mh">0x000000030006000a</span> \
<span class="mh">0x000001000006000a</span> <span class="mh">0x000001010006000a</span> <span class="mh">0x000001020006000a</span> <span class="mh">0x000001030006000a</span>
</pre></div>
</div>
<p>Successfully yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_addr_read</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">:</span> <span class="n">pmode</span><span class="p">(</span><span class="mh">0x1</span><span class="p">)</span>
<span class="p">(</span><span class="mh">0x0000000001f4000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000000101f4000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000000201f4000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000000301f4000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000010001f4000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000010101f4000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000010201f4000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000010301f4000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000000000c8000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000000100c8000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000000200c8000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000000300c8000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000010000c8000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000010100c8000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000010200c8000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0000010300c8000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000010000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000020000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000030000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001010000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001020000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001030000000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000000006000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">006</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000010006000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">006</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000020006000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">006</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000000030006000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">006</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001000006000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">006</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001010006000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">006</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001020006000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">006</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x000001030006000a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0010</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">006</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>It is worth mentioning that the vectorized reads can be non-contiguous not only
within a block but also scattered across different different blocks, in
different LUNs, and channels.</p>
<p>However, when using plane-mode ensure that addresses are constructed across
planes and all sectors are read as in the example above.</p>
</div>
</div>
</div>
<div class="section" id="virtual-block">
<h2>Virtual Block<a class="headerlink" href="#virtual-block" title="Permalink to this headline">¶</a></h2>
<p>The physical addressing interface <code class="docutils literal"><span class="pre">nvm_addr</span></code> provides full control over the
construction of vectorized IO commands. It is known that with great power comes
great responsibility, responsibility which increase the cognitive load on the
developer when integrating vectorized IO directly at the application level.</p>
<p>liblightnvm introduces a pure software abstraction, a virtual block, to reduce
the cognitive load for application developers.</p>
<p>A virtual block behaves as a physical, that is, the constraints of working with
NAND media also apply to a virtual block. However, the abstraction encapsulates
the command and address construction of parallel vectorized IO and exposes a
flat address space which is read/written in a manner equivalent to the
read/write primitives offered by libc.</p>
<p>A virtual block will at a minimum consist of the given block address across all
planes. So it by default encapsulates concerns regarding plane-mode
constraints.</p>
<p>We erase, write, and read the virtual block:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_vblk</span> <span class="n">set_erase</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme1n1</span> <span class="mh">0x0000000000000002</span>
<span class="n">nvm_vblk</span> <span class="n">set_write</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme1n1</span> <span class="mh">0x0000000000000002</span>
<span class="n">nvm_vblk</span> <span class="n">set_read</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme1n1</span> <span class="mh">0x0000000000000002</span>
</pre></div>
</div>
<p>Yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_vblk_erase</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
<span class="n">vblk</span> <span class="p">{</span>
 <span class="n">nbytes</span><span class="p">(</span><span class="mi">16777216</span><span class="n">b</span><span class="p">:</span><span class="mi">16</span><span class="n">Mb</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">vblk</span><span class="o">-</span><span class="n">naddrs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
 <span class="mi">00</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0000000000000002</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0002</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="n">Ran</span> <span class="n">nvm_vblk_erase</span><span class="p">,</span> <span class="n">elapsed</span> <span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="p">:</span> <span class="mf">0.025978</span>
<span class="o">**</span> <span class="n">nvm_vblk_write</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
<span class="n">vblk</span> <span class="p">{</span>
 <span class="n">nbytes</span><span class="p">(</span><span class="mi">16777216</span><span class="n">b</span><span class="p">:</span><span class="mi">16</span><span class="n">Mb</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">vblk</span><span class="o">-</span><span class="n">naddrs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
 <span class="mi">00</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0000000000000002</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0002</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="n">Ran</span> <span class="n">nvm_buf_alloc</span><span class="p">,</span> <span class="n">elapsed</span> <span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="p">:</span> <span class="mf">0.023954</span>
<span class="n">Ran</span> <span class="n">nvm_vblk_write</span><span class="p">,</span> <span class="n">elapsed</span> <span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="p">:</span> <span class="mf">0.934091</span>
<span class="o">**</span> <span class="n">nvm_vblk_read</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
<span class="n">vblk</span> <span class="p">{</span>
 <span class="n">nbytes</span><span class="p">(</span><span class="mi">16777216</span><span class="n">b</span><span class="p">:</span><span class="mi">16</span><span class="n">Mb</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">vblk</span><span class="o">-</span><span class="n">naddrs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
 <span class="mi">00</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0000000000000002</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0002</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="n">Ran</span> <span class="n">nvm_buf_alloc</span><span class="p">,</span> <span class="n">elapsed</span> <span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="p">:</span> <span class="mf">0.000014</span>
<span class="n">Ran</span> <span class="n">nvm_vblk_read</span><span class="p">,</span> <span class="n">elapsed</span> <span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="p">:</span> <span class="mf">0.153033</span>
</pre></div>
</div>
<div class="section" id="using-physical-block-sets">
<h3>Using physical block sets<a class="headerlink" href="#using-physical-block-sets" title="Permalink to this headline">¶</a></h3>
<p>To obtain parallel IO, in addition to plane-mode, we construct a virtual block
consisting of multiple physical blocks on distinct parallel units (LUNs). As an
example, we create a virtual block, consisting of a block from the first LUN of
each channel on the device:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mh">0x0000000000000002</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0002</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0a0700000000014d</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">07</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0333</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0301000000000014</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">03</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">01</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0020</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mh">0x0500000000000190</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">05</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0400</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>We erase, write and read the virtual block:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_vblk</span> <span class="n">set_erase</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme1n1</span> <span class="mh">0x0000000000000002</span> <span class="mh">0x0a0700000000014d</span> <span class="mh">0x0301000000000014</span> <span class="mh">0x0500000000000190</span>
<span class="n">nvm_vblk</span> <span class="n">set_write</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme1n1</span> <span class="mh">0x0000000000000002</span> <span class="mh">0x0a0700000000014d</span> <span class="mh">0x0301000000000014</span> <span class="mh">0x0500000000000190</span>
<span class="n">nvm_vblk</span> <span class="n">set_read</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme1n1</span> <span class="mh">0x0000000000000002</span> <span class="mh">0x0a0700000000014d</span> <span class="mh">0x0301000000000014</span> <span class="mh">0x0500000000000190</span>
</pre></div>
</div>
<p>Yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_vblk_erase</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
<span class="n">vblk</span> <span class="p">{</span>
 <span class="n">nbytes</span><span class="p">(</span><span class="mi">67108864</span><span class="n">b</span><span class="p">:</span><span class="mi">64</span><span class="n">Mb</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">vblk</span><span class="o">-</span><span class="n">naddrs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
 <span class="mi">00</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0000000000000002</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0002</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="mi">01</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0a0700000000014d</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">07</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0333</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="mi">02</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0301000000000014</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">03</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">01</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0020</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="mi">03</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0500000000000190</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">05</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0400</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="n">Ran</span> <span class="n">nvm_vblk_erase</span><span class="p">,</span> <span class="n">elapsed</span> <span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="p">:</span> <span class="mf">0.027606</span>
<span class="o">**</span> <span class="n">nvm_vblk_write</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
<span class="n">vblk</span> <span class="p">{</span>
 <span class="n">nbytes</span><span class="p">(</span><span class="mi">67108864</span><span class="n">b</span><span class="p">:</span><span class="mi">64</span><span class="n">Mb</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">vblk</span><span class="o">-</span><span class="n">naddrs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
 <span class="mi">00</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0000000000000002</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0002</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="mi">01</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0a0700000000014d</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">07</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0333</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="mi">02</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0301000000000014</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">03</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">01</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0020</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="mi">03</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0500000000000190</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">05</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0400</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="n">Ran</span> <span class="n">nvm_buf_alloc</span><span class="p">,</span> <span class="n">elapsed</span> <span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="p">:</span> <span class="mf">0.071390</span>
<span class="n">Ran</span> <span class="n">nvm_vblk_write</span><span class="p">,</span> <span class="n">elapsed</span> <span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="p">:</span> <span class="mf">0.980600</span>
<span class="o">**</span> <span class="n">nvm_vblk_read</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
<span class="n">vblk</span> <span class="p">{</span>
 <span class="n">nbytes</span><span class="p">(</span><span class="mi">67108864</span><span class="n">b</span><span class="p">:</span><span class="mi">64</span><span class="n">Mb</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">vblk</span><span class="o">-</span><span class="n">naddrs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
 <span class="mi">00</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0000000000000002</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0002</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="mi">01</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0a0700000000014d</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">07</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0333</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="mi">02</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0301000000000014</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">03</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">01</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0020</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="mi">03</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x0500000000000190</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">05</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">00</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0400</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="n">Ran</span> <span class="n">nvm_buf_alloc</span><span class="p">,</span> <span class="n">elapsed</span> <span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="p">:</span> <span class="mf">0.000012</span>
<span class="n">Ran</span> <span class="n">nvm_vblk_read</span><span class="p">,</span> <span class="n">elapsed</span> <span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="p">:</span> <span class="mf">0.167836</span>
</pre></div>
</div>
<p>This demonstrates a weak-scaling experiment, increasing the workload
proportionally with the parallel units consumes approxiately the same amount of
wall-clock time, thus achieving near linear speedup by utilizing parallel units
on the device.</p>
</div>
<div class="section" id="using-physical-block-line">
<h3>Using physical block line<a class="headerlink" href="#using-physical-block-line" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="bad-block-table">
<h2>Bad-Block-Table<a class="headerlink" href="#bad-block-table" title="Permalink to this headline">¶</a></h2>
<p>The state of the underlying media is exposed to the user through the
bad-block-interface (BBT). A bad-block table exists for each LUN, retrieving
the BBT for LUN 3 on channel 2 is done by executing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nvm_bbt</span> <span class="n">get</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">vi</span> <span class="n">free</span>
</pre></div>
</div>
<p>The command outputs the entire table so we filter out the less interesting free
entries, thus yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_bbt_get</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
<span class="n">bbt</span> <span class="p">{</span>
 <span class="n">addr</span><span class="p">(</span><span class="mh">0x0203000000000000</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">02</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">03</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0000</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="n">nblks</span><span class="p">(</span><span class="mi">2040</span><span class="p">),</span>
 <span class="n">npl_blks</span><span class="p">(</span><span class="mi">1020</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">blk</span><span class="p">(</span><span class="mi">0041</span><span class="p">):</span> <span class="p">[</span>  <span class="n">BAD</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="n">BAD</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">]</span>
 <span class="p">},</span>
  <span class="n">nbad</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="n">ngbad</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
  <span class="n">ndmrk</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
  <span class="n">nhmrk</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A given block can be in one of the following states: FREE, BAD, GROWN BAD,
DEVICE MARKED/RESERVED, and HOST MARKED/RESERVED. State can be changed by e.g.
marking block 42 as HOST RESERVED:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">nvm_bbt</span> <span class="n">mark_f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nvme0n1</span> <span class="mh">0x0203000000000042</span>
</pre></div>
</div>
<p>Yielding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_bbt_mark</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
<span class="p">(</span><span class="mh">0x020300000000002a</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">02</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">03</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0042</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only the system administrator is able to make state changes to the
BBT</p>
</div>
<p>Retrieving the BBT after the state change yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">**</span> <span class="n">nvm_bbt_get</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
<span class="n">bbt</span> <span class="p">{</span>
 <span class="n">addr</span><span class="p">(</span><span class="mh">0x0203000000000000</span><span class="p">){</span> <span class="n">ch</span><span class="p">(</span><span class="mi">02</span><span class="p">),</span> <span class="n">lun</span><span class="p">(</span><span class="mi">03</span><span class="p">),</span> <span class="n">pl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">blk</span><span class="p">(</span><span class="mi">0000</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="mi">000</span><span class="p">),</span> <span class="n">sec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
 <span class="n">nblks</span><span class="p">(</span><span class="mi">2040</span><span class="p">),</span>
 <span class="n">npl_blks</span><span class="p">(</span><span class="mi">1020</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">blk</span><span class="p">(</span><span class="mi">0041</span><span class="p">):</span> <span class="p">[</span>  <span class="n">BAD</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="n">BAD</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">]</span>
  <span class="n">blk</span><span class="p">(</span><span class="mi">0042</span><span class="p">):</span> <span class="p">[</span> <span class="n">HMRK</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="n">HMRK</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="p">]</span>
 <span class="p">},</span>
  <span class="n">nbad</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="n">ngbad</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
  <span class="n">ndmrk</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
  <span class="n">nhmrk</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">C API for retrieving and modifying the BBT is done using
<code class="docutils literal"><span class="pre">nvm_bbt_get</span></code> which return a <code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">nvm_bbt*</span></code>. To modify it, make
a copy with <code class="docutils literal"><span class="pre">nvm_bbt_alloc_cp</span></code>, and persist it with <code class="docutils literal"><span class="pre">nvm_bbt_set</span></code>.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="c.html" class="btn btn-neutral float-right" title="C API" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="background.html" class="btn btn-neutral" title="Background" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, LightNVM.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>